<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3 Şerit Runner - Fullscreen</title>
<style>
  html,body {
    margin:0; padding:0;
    width:100%; height:100%;
    overflow:hidden;
    background:#0f1115;
    font-family:system-ui;
  }
  #hud {
    position:fixed;
    top:10px; left:15px;
    color:white;
    z-index:10;
    font-size:18px;
    font-weight:800;
    text-shadow:0 0 6px #000;
  }
  #footer {
    position:fixed;
    right:10px;
    bottom:10px;
    color:white;
    opacity:0.45;
    font-size:13px;
    font-weight:600;
    z-index:10;
  }
  #restartBtn {
    position:fixed;
    top:10px; right:10px;
    background:#fff2;
    color:white;
    border:1px solid #fff4;
    padding:8px 12px;
    border-radius:8px;
    font-weight:800;
    z-index:10;
  }
  canvas {
    position:fixed;
    top:0; left:0;
    width:100vw;
    height:100vh;
    touch-action:none;
  }
</style>
</head>
<body>

<div id="hud">Skor: 0<br>Coin: 0</div>
<div id="footer">By Yiğit Alp</div>
<button id="restartBtn">Yeniden</button>
<canvas id="c"></canvas>

<script>
(()=>{

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  let W = canvas.width, H = canvas.height;

  const laneX = ()=>[W*0.28, W*0.5, W*0.72];
  const groundY = ()=>H*0.82;

  const player = {
    lane:1, x:0, y:0, w:40, h:58,
    vy:0, onGround:true, slideT:0, invulT:0
  };

  function resetPlayer(){
    W = canvas.width; H = canvas.height;
    player.lane = 1;
    player.x = laneX()[1];
    player.y = groundY();
    player.vy = 0;
    player.onGround = true;
    player.slideT = 0;
    player.invulT = 0;
  }

  resetPlayer();

  let running = true;
  let score = 0;
  let coins = 0;
  let speed = 6;
  let t = 0;
  let spawnT = 0;

  const obs = [];
  const pick = [];

  const keys = new Set();
  onkeydown = e => keys.add(e.key.toLowerCase());
  onkeyup   = e => keys.delete(e.key.toLowerCase());

  function moveLane(d){
    if(!running) return;
    player.lane = Math.max(0, Math.min(2, player.lane + d));
    player.x = laneX()[player.lane];
  }
  function jump(){
    if(player.onGround && running){
      player.vy = -15;
      player.onGround = false;
    }
  }
  function slide(){
    if(player.onGround && running){
      player.slideT = 26;
    }
  }

  // Touch swipe
  let ts=null;
  canvas.addEventListener("pointerdown",e=>{
    ts={x:e.clientX,y:e.clientY,t:performance.now()};
    canvas.setPointerCapture(e.pointerId);
  });
  canvas.addEventListener("pointerup",e=>{
    if(!ts) return;
    let dx=e.clientX-ts.x, dy=e.clientY-ts.y;
    if(Math.abs(dx)>35 || Math.abs(dy)>35){
      if(Math.abs(dx)>Math.abs(dy)){
        moveLane(dx>0?1:-1);
      } else {
        dy<0?jump():slide();
      }
    }
    ts=null;
  });

  document.getElementById("restartBtn").onclick = ()=>{
    running = true;
    score=0; coins=0; speed=6; t=0;
    obs.length=0; pick.length=0;
    spawnT=0;
    resetPlayer();
  };

  function spawn(){
    let lane = rand(0,2);
    let r = Math.random();
    if(r<0.65){
      let type = Math.random()<0.25?"bar":"block";
      if(type==="block") obs.push({lane,y:-40,w:44,h:52,type});
      else obs.push({lane,y:-40,w:62,h:18,type});
    } else {
      let c = 1+(Math.random()<0.5)+(Math.random()<0.3);
      for(let i=0;i<c;i++) pick.push({lane,y:-60-i*55,r:12});
    }
  }

  function update(){
    // resize fix
    W = canvas.width;
    H = canvas.height;

    if(keys.has("a")||keys.has("arrowleft")){ keys.delete("a");keys.delete("arrowleft"); moveLane(-1); }
    if(keys.has("d")||keys.has("arrowright")){keys.delete("d");keys.delete("arrowright"); moveLane(1); }
    if(keys.has("w")||keys.has("arrowup"))   {keys.delete("w");keys.delete("arrowup"); jump(); }
    if(keys.has("s")||keys.has("arrowdown")) {keys.delete("s");keys.delete("arrowdown"); slide(); }

    if(!running) return;

    t++; speed = Math.min(14, 6+t/600); score++;
    player.vy += 0.75;
    player.y += player.vy;

    if(player.y >= groundY()){
      player.y = groundY();
      player.vy = 0;
      player.onGround = true;
    }

    if(player.slideT>0) player.slideT--;
    if(player.invulT>0) player.invulT--;

    spawnT--;
    if(spawnT<=0){
      spawn();
      spawnT=Math.max(25,70-speed*3);
    }

    obs.forEach(o=>o.y+=speed);
    pick.forEach(c=>c.y+=speed);

    while(obs.length && obs[0].y > H+100) obs.shift();
    while(pick.length && pick[0].y>H+100) pick.shift();

    const pr = playerRect();

    // coin
    for(let i=pick.length-1;i>=0;i--){
      let c=pick[i];
      let cx=laneX()[c.lane], cy=c.y;
      if(dist(cx,cy,pr.x+pr.w/2,pr.y+pr.h/2)<c.r+20){
        pick.splice(i,1);
        coins++; score+=40;
      }
    }

    if(player.invulT===0){
      for(let o of obs){
        let ox=laneX()[o.lane];
        let r=obRect(o,ox);
        if(hit(pr,r)){
          running=false;
          break;
        }
      }
    }

    document.getElementById("hud").innerHTML = 
      `Skor: ${score}<br>Coin: ${coins}`;
  }

  function obRect(o,x){
    if(o.type==="block")
      return {x:x-o.w/2,y:o.y-o.h,w:o.w,h:o.h};
    return {x:x-o.w/2,y:o.y-70,w:o.w,h:o.h};
  }

  function playerRect(){
    let h = player.slideT>0?32:player.h;
    return {
      x: player.x-player.w/2,
      y: (player.slideT>0?groundY()-h:player.y-player.h),
      w:player.w,h
    };
  }

  function hit(a,b){
    return a.x<b.x+b.w && a.x+a.w>b.x &&
           a.y<b.y+b.h && a.y+a.h>b.y;
  }

  function dist(a,b,c,d){ return Math.hypot(a-c,b-d); }

  function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle="#0b0d12";
    ctx.fillRect(0,0,W,H);

    ctx.strokeStyle="#7b8aa6";
    ctx.globalAlpha=0.35;
    ctx.lineWidth=2;
    ctx.setLineDash([12,12]);
    [W*0.39,W*0.61].forEach(x=>{
      ctx.beginPath();
      ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke();
    });
    ctx.setLineDash([]);
    ctx.globalAlpha=1;

    // coins
    pick.forEach(c=>{
      let x=laneX()[c.lane];
      ctx.fillStyle="#ffd24a";
      circle(x,c.y,c.r);
    });

    // obstacles
    obs.forEach(o=>{
      let x=laneX()[o.lane];
      ctx.fillStyle="#ff4d4d";
      let r=obRect(o,x);
      round(r.x,r.y,r.w,r.h,10);
    });

    // player
    let p=playerRect();
    ctx.fillStyle="#4aa3ff";
    round(p.x,p.y,p.w,p.h,10);

    if(!running){
      ctx.globalAlpha=0.85;
      ctx.fillStyle="#000";
      ctx.fillRect(0,0,W,H);
      ctx.globalAlpha=1;
      ctx.fillStyle="#fff";
      ctx.font="900 38px system-ui";
      ctx.textAlign="center";
      ctx.fillText("GAME OVER",W/2,H/2);
      ctx.textAlign="start";
    }

    requestAnimationFrame(draw);
  }

  function circle(x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
  }

  function round(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
    ctx.fill();
  }

  function loop(){
    update();
    requestAnimationFrame(loop);
  }

  loop();
  draw();

})();
</script>
</body>
</html>